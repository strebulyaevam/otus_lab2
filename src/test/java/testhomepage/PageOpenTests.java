package testhomepage;

import io.github.bonigarcia.wdm.WebDriverManager;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.openqa.selenium.Capabilities;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;


import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.openqa.selenium.firefox.FirefoxOptions;
import org.testng.Assert;
import org.testng.annotations.AfterClass;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;
import org.testng.annotations.Parameters;


public class PageOpenTests {

    private static Logger Log = LogManager.getLogger(PageOpenTests.class);

    WebDriver driver;


    @BeforeClass
    public void init(){

        String browser = System.getProperty("browser"); // Get parameter from maven


        try{
            driver = WebDriverFactory.createNewDriver(browser);
            if (driver==null) {
                Log.fatal("New driver for " + browser +" browser isn't created");
                Assert.fail();
            }
        } catch (Exception e){
            Log.fatal("New driver for " + browser +" browser isn't created");
            Assert.fail();
        }
    }


    @Parameters({"hostname"})
    @Test
    public void getHomePage(String hostname) throws Exception {
        Log.info("Try to get " + hostname);

        try {
            driver.get(hostname);
            Log.info(hostname + " was got successfully");
        } catch (Exception e) {
            Log.fatal("Host - " + hostname +" isn't available");
            Assert.fail();
        }

        OtusHome homePage = new OtusHome(driver);

        try {
            Log.info("Check "+ hostname + " home page");

            Assert.assertTrue(homePage.findMainCourses(), "get Otus home page is failed");
        } catch (Exception e) {
            Log.error("Error - " + hostname + " home page didn't get", e);
            throw e;
        }
    }

    @Parameters({"browser"})
    @AfterClass
    public void quitBrowser (String browser) {
        if(driver!=null){
            Log.info("Quit from " + browser);
            driver.quit();
        }
    }
}
